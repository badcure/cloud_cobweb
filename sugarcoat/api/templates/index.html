{% extends 'base.html' %}

{% set header_class="auth_header" %}

{% block header_body %}
    {% if g.user_info %}
        <span class="auth_expiretime">Expires in :</span>
        {% if g.user_info.token_seconds_left <= 0 %}
        Auth as expired
        {% else %}
            {% if g.user_info.token_seconds_left > 7200 %}
                {{ (g.user_info.token_seconds_left/3600)|int }} hour(s)
            {% elif g.user_info.token_seconds_left > 60 %}
                {{ (g.user_info.token_seconds_left/60)|int }} minute(s)
            {% else %}
                {{ g.user_info.token_seconds_left }} seconds.
            {% endif %}
        {% endif %}
        <br>

        <div class="auth_token">
            See complete auth <a href="/auth_token">here</a><br>
        </div>
        <div class="refresh_token">
            <a href="/refresh_auth">Refresh auth info</a><br>
        </div>
    {%  else %}
        No info, need to log in.
    {%  endif %}
{% endblock %}


{% block main_body %}
    <div id="complete_service_catalog">
        <h2> Identity </h2>
        {% if not g.user_info.token %}
            <span id="login_api_title">Login through API</span> -
            <span id="login_validate_token_title">Login with validated token</span>

            <div id="login_api">
                <form method="POST" action="/cloudIdentity/all/tokens">
                    {{ form.hidden_tag() }}
                    <div class="json_format">
                        "stringaaaaa"
                    </div>
                    <div class="json_format">
                        {
                            "auth": {
                                "RAX-KSKEY:apiKeyCredentials": {
                                    "username": "",
                                    "apiKey": ""
                                }
                            }
                        }
                    </div>
                    <input type="submit" name="Login">
                </form>
            </div>
            <div id="login_validate_token">
                <form method="POST" action="/cloudIdentity/all/tokens">
                    {{ form_validate.hidden_tag() }}

                    {% for field in form_validate %}
                        {% if field.widget.input_type != 'hidden' %} {{ field.label }} {% endif %}
                        {{ field }}<br>
                    {% endfor %}
                    <input type="submit" name="Login">
                </form>
            </div>

        {%  endif %}
        <h2>Service Catalog</h2>
        <ul>
            {% for role in g.user_info.service_catalog_list %}
            <div id="catalog_{{role.name}}">
                <li>
                    {{ role.name }}
                    <ul>
                        {% for endpoint in role.endpoints %}
                        {% if endpoint.region %}
                        <li> Region {{endpoint.region}} - {{endpoint.publicURL}} - <a href="/{{role.name}}/{{ endpoint.region}}">Show</a>
                            {% else %}
                        <li> Region global - {{endpoint.publicURL}} - <a href="/{{role.name}}/all">Show</a>

                            {% endif %}
                            {% endfor %}
                    </ul>
                </li>
            </div>
            {% endfor %}
        </ul>
    </div>
    <script>
        $("#login_validate_token").hide();
        $("#login_api").hide();

        $("#login_validate_token_title").click(function(){
            $("#login_api").hide();
            $("#login_validate_token").show();
        });

        $("#login_api_title").click(function(){
            $("#login_api").show();
            $("#login_validate_token").hide();
        });
        $("div.json_format").each(function(index, element) {
            var asdf = JSON.parse(element.innerHTML);
            element.innerHTML = display_json_new(asdf);
        })
    </script>

{% endblock %}

